/* Copyright (c) 2011, salesforce.com <http://salesforce.com> , inc.*/
void 0===window.$j&&($j=$.noConflict());var sforce=window.sforce;void 0===sforce&&(sforce={});String.prototype.startsWith=function(b){return this.substr(0,b.length)===b};String.prototype.endsWith=function(b){return this.substr(this.length-b.length,this.length)===b};Array.prototype.last=function(){return this[this.length-1]};function htmlEncode(b){return b?$j("<div/>").text(b).html():b}function htmlDecode(b){return b?$j("<div/>").html(b).text():b}
function formatStr(b,c){b&&(b=htmlEncode(b));return b&&c&&b.length>c?b.substr(0,c-3)+"...":b}function cleanupPhone(b){return b?(b=htmlEncode(b),(b.trim().startsWith("+")?"+":"")+b.replace(/[^0-9]/g,"")):b}
function formatAddress(b){return(b.MailingStreet?htmlEncode(b.MailingStreet).replace(/\n/g,", ")+"\n":"")+(b.MailingCity?htmlEncode(b.MailingCity).replace(/\n/g,", ")+", ":"")+(b.MailingState?htmlEncode(b.MailingState).replace(/\n/g,", ")+" ":"")+(b.MailingPostalCode?htmlEncode(b.MailingPostalCode).replace(/\n/g,", ")+" ":"")+(b.MailingCountry?htmlEncode(b.MailingCountry).replace(/\n/g,""):"")}function getBaseUrl(){return siteUrl.endsWith("/")?siteUrl.substring(0,siteUrl.length-1):siteUrl}
function getFieldDescribe(){return eval("("+StorageManager.getSessionValue(contact_describe_storage_key)+")")}function truncateLongText(){}function isPortrait(){return window.innerHeight>window.innerWidth}var contact_describe_storage_key="SFDC-CONTACT-DESCRIBE";
function fetchContactDescribe(b){ManageUserSession.getApiClient().describeContactViaApex(function(b){contactLabel=b.label||"Contact";contactPluralLabel=b.labelPlural||"Contacts";if(b.fields){var d={};$j.each(b.fields,function(){var b={label:this.label,type:this.type,length:this.length};d[this.name]=b;"reference"==b.type&&(b.relationshipName=this.relationshipName,b.referenceTo=this.referenceTo,b.relationshipLabel=this.relationshipLabel||"",d[this.relationshipName]=b)});StorageManager.setSessionValue(contact_describe_storage_key,
JSON.stringify(d))}b.recordTypeInfos&&1<b.recordTypeInfos.length&&(hasRecordTypes=!0);b.childRelationships&&(hasChatterEnabled=b.childRelationships.some(function(b){return"ContactFeed"==b.childSObject}))},errorCallback,function(c,d){"function"==typeof b&&b("success"==d)})}
function createScroller(b,c,d){var e,f,g,h,b="object"==typeof b?b:$j("#"+b);if(c){var j=b.find("#pullDown")[0];j||($j(b.children().children().get(0)).before('<div id="pullDown"><span class="app-images appleui pullDownIcon"></span><span class="pullDownLabel">Pull down to refresh</span> </div>'),j=b.find("#pullDown")[0]);e=j.offsetHeight;f=function(){if(j.className.match("loading")){j.className="";j.querySelector(".pullDownLabel").innerHTML="Pull down to refresh"}};g=function(){if(this.y>5&&!j.className.match("flip")){j.className=
"flip";j.querySelector(".pullDownLabel").innerHTML="Release to refresh";this.minScrollY=0}else if(this.y<5&&j.className.match("flip")){j.className="";j.querySelector(".pullDownLabel").innerHTML="Pull down to refresh";this.minScrollY=-e}};h=function(){if(j.className.match("flip")){j.className="loading";j.querySelector(".pullDownLabel").innerHTML="Loading...";c()}}}var k={useTransition:!0,topOffset:e||0};d&&d.onBeforeScrollStart&&(k.onBeforeScrollStart=d.onBeforeScrollStart);f&&(k.onRefresh=f);g&&(k.onScrollMove=
g);h&&(k.onScrollEnd=h);return new iScroll(b[0],k)}
function errorCallback(b,c){if("error"==c){var d=b.responseText;try{d=$j.parseJSON(d)}catch(e){}switch(b.status){case 403:if(/NO_API_ACCESS/gi.test(b.responseText)&&ManageUserSession.isActive()){alert(d.message);logout(!0);break}case 401:alert(d.message||"Session expired. Please relogin.");ManageUserSession.invalidate(!0,function(){window.location.reload()});break;default:alert("Server Unavailable. Check network connection or try again later.")}}else c="timeout",alert("Session timed out."),ManageUserSession.invalidate(!0,
function(){window.location.reload()})}var last_visited_loc_storage_key="LAST-VISIT-LOC";function updateLastVisitLoc(b){b?StorageManager.setLocalValue(last_visited_loc_storage_key,b):StorageManager.clearLocalValue(last_visited_loc_storage_key)}
function getEulaResponse(b){SettingsManager.showEula(function(){ManageUserSession.getApiClient().submitEulaResponse(ManageUserSession.getClientId(),this.id,function(c){c.success&&"true"==c.success?(ManageUserSession.updateEula(!0),SettingsManager.hideEula(),"function"==typeof b&&b()):(c.error&&alert(c.error),c.errorCode&&"INVALID_CLIENT"==c.errorCode&&logout(!1))},errorCallback)},function(){logout(!0)})}
function logout(b){ManageUserSession.kill(function(){b||StorageManager.setSessionValue(login_redirect_storage_key,!1);window.location=getBaseUrl()})}
function getContacts(b,c){listView.showBusyIndicator("Loading...");ManageUserSession.getApiClient().queryContactsViaApex(b,function(b){sobjectModel.setRecords(b.records)},errorCallback,function(d,e){listView.updateList(sobjectModel.records);listView.hideBusyIndicator();listView.refreshScroller(function(){getContacts(b)});"function"==typeof c&&c("success"==e)})}
function searchContacts(b,c){listView.showBusyIndicator("Searching...");ManageUserSession.getApiClient().searchContactsViaApex(b,function(b){sobjectModel.setRecords(b)},errorCallback,function(d,e){listView.updateList(sobjectModel.records);listView.hideBusyIndicator();listView.refreshScroller(function(){searchContacts(b)});"function"==typeof c&&c(e)})}
function prepareSession(b){"false"==StorageManager.getSessionValue(login_redirect_storage_key)?(StorageManager.clearSessionValue(login_redirect_storage_key),setTimeout(SettingsManager.show,10)):(LocalyticsManager.logAppStarted(),ManageUserSession.initialize(function(){LocalyticsManager.logAuthComplete();ManageUserSession.isEulaAccepted()?sessionCallback():getEulaResponse(sessionCallback)},b))}
void 0===sforce.Client&&(sforce.Client=function(b){this.sessionHeader=null;this.SESSION_HEADER="App-Session";this.errorHandler=function(c,d){return function(e,f){if("abort"!=f)switch(e.status){case 401:if(c.allowRetry&&"function"==typeof b){c.retryingRequest=!0;b(function(){c.replay()});break}default:c.allowRetry=!1,"function"==typeof d&&d(e,f)}}}},sforce.Client.RequestManager=function(b,c){this.xhr=b;this.allowRetry=c||!0},sforce.Client.RequestManager.prototype.abort=function(){this.allowRetry=!1;
"pending"==this.xhr.state()?this.xhr.abort():this.retryingRequest&&this.settings.complete(this.xhr,"abort");this.retryingRequest=!1},sforce.Client.RequestManager.prototype.replay=function(){this.allowRetry&&(this.allowRetry=!1,this.xhr=$j.ajax(this.settings))},sforce.Client.prototype.ajax=function(b,c,d,e,f,g,h){var j=this,k=new sforce.Client.RequestManager;k.xhr=$j.ajax({type:b,url:c,processData:!0,data:d,dataType:e,success:f,error:j.errorHandler(k,g),beforeSend:function(b,c){k.settings=c;j.sessionHeader&&
b.setRequestHeader(j.SESSION_HEADER,j.sessionHeader)},complete:function(b,c){"function"==typeof h&&(!k.allowRetry||!k.retryingRequest)&&h(b,c)}});return k},sforce.Client.prototype.getJSON=function(b,c,d,e,f,g){return this.ajax(b,c,d,"json",e,f,g)},sforce.Client.prototype.setSessionHeader=function(b){this.sessionHeader=b},sforce.Client.prototype.getAuthorizeUrl=function(b){return getBaseUrl()+"/services/apexrest/oauth2/?doAuthorize&host="+b},sforce.Client.prototype.refreshAccessToken=function(b,c,
d,e,f,g){var h=getBaseUrl()+"/services/apexrest/oauth2/refreshAccess";return this.getJSON("POST",h,"rt="+d+"&pass="+b+"&cid="+c,e,f,g)},sforce.Client.prototype.obtainAccessToken=function(b,c,d,e,f,g){var h=getBaseUrl()+"/services/apexrest/oauth2/authenticate";return this.getJSON("POST",h,"code="+c+(d?"&pass="+d:"")+(b?"&host="+b:""),e,f,g)},sforce.Client.prototype.prepareSession=function(b,c,d){var e=getBaseUrl()+"/services/apexrest/oauth2/prepareSession";return this.getJSON("POST",e,null,b,c,d)},
sforce.Client.prototype.prepareSessionFromOAuth=function(b,c,d,e,f,g){var h=getBaseUrl()+"/services/apexrest/oauth2/prepareSession";this.sessionHeader=null;return this.getJSON("POST",h,"accessToken="+b+"&instanceUrl="+c+"&identityUrl="+d,e,f,g)},sforce.Client.prototype.revokeSession=function(b,c,d,e,f){var g=getBaseUrl()+"/services/apexrest/oauth2/revokeSession";return this.getJSON("POST",g,b&&c?"cid="+b+"&rt="+c:"",d,e,f)},sforce.Client.prototype.queryContactsViaApex=function(b,c,d,e){var f=getBaseUrl()+
"/services/apexrest/cvapi";return this.getJSON("GET",f,"action=fetchContacts&filter="+b,c,d,e)},sforce.Client.prototype.retrieveContactViaApex=function(b,c,d,e,f){var g=getBaseUrl()+"/services/apexrest/cvapi";return this.getJSON("GET",g,"action=retrieveContact&id="+b+"&fields="+c,d,e,f)},sforce.Client.prototype.searchContactsViaApex=function(b,c,d,e){var f=getBaseUrl()+"/services/apexrest/cvapi";return this.getJSON("GET",f,"action=searchContacts&text="+b,c,d,e)},sforce.Client.prototype.fetchChatterViaApex=
function(b,c,d,e){var f=getBaseUrl()+"/services/apexrest/cvapi";return this.getJSON("GET",f,"action=fetchChatter&ids="+b,c,d,e)},sforce.Client.prototype.fetchActivitiesViaApex=function(b,c,d,e){var f=getBaseUrl()+"/services/apexrest/cvapi";return this.getJSON("GET",f,"action=fetchActivities&ids="+b,c,d,e)},sforce.Client.prototype.getUsersInfoViaApex=function(b,c,d,e,f){var g=getBaseUrl()+"/services/apexrest/cvapi";return this.getJSON("GET",g,"action=getUsersInfo&id="+b+"&fetchPhotos="+c,d,e,f)},sforce.Client.prototype.describeContactViaApex=
function(b,c,d){var e=getBaseUrl()+"/services/apexrest/cvapi";return this.getJSON("GET",e,"action=describeContact",b,c,d)},sforce.Client.prototype.getContactDetailsViaApex=function(b,c,d,e,f){var g=getBaseUrl()+"/ContactDetails",h=(new Date).getTimezoneOffset();return this.ajax("GET",g,"id="+b+"&rtid="+(c||"")+"&tzOffset="+h,"html",d,e,f)},sforce.Client.prototype.getContactAppEula=function(b,c,d){var e=getBaseUrl()+"/ContactsAppEula";return this.ajax("GET",e,null,"html",b,c,d)},sforce.Client.prototype.submitEulaResponse=
function(b,c,d,e,f){var g=getBaseUrl()+"/services/apexrest/cvapi";return this.getJSON("GET",g,"action=manageEula&clientId="+b+"&eulaResponse="+c,d,e,f)});
var SettingsManager=function(){function b(d){if(d&&f!=d){e&&j();e=createScroller(c.find(".settings_body "+d));f=d;$j(window).orientationChange(function(){b()})}else e&&e.refresh()}var c,d,e,f,g,h=false,j=function(){if(e){e.destroy();f=e=void 0}},k=function(){var b=ManageUserSession.getLoginHostType();if(!b){b=c.find("#hosts table td")[0].id;ManageUserSession.setLoginHostType(b)}if(b){c.find("#connection #hostType #name").text(c.find("#hosts #"+b+" span").text());c.find("#hosts table td").css("color",
"black");c.find("#hosts #"+b).css("color","#395483").append(c.find("#hosts #check"))}c.find("#main #connection #host_url input").val(ManageUserSession.getLoginHostUrl())},l=function(d,e){ManageUserSession.getApiClient().getContactAppEula(function(b){b=$j(b);b.find("head, script").remove();c.find("#eula .content").empty().append(b);if(d){b=c.find("#eula_buttons").show();c.find("#eula").css("margin-bottom",b.outerHeight()+"px")}else c.find("#eula").css("margin-bottom","0")},errorCallback,function(c,
d){b("#eula");typeof e=="function"&&e(d)})},n=function(d,e,f,g){var l=$j(this),j;h&&setTimeout(function(){c.find("#main #connection #host_url input").blur()},10);l.addClass("cellselected");c.find("#header #done").hide();j=function(){l.removeClass("cellselected");c.find("#main").css("visibility","hidden");typeof g=="function"&&g()};if(useAnimations)c.find("#main").changePage(c.find(d),false,j);else{c.find("#main").hide();c.find(d).show().css("visibility","");j()}c.find("#header #title").text(e);b(d);
if(f){var n=c.find(d);c.find("#header #left").show().touch(function(){c.find("#header #left").hide().off();if(useAnimations)n.changePage(c.find("#main"),true,function(){n.css("visibility","hidden")});else{n.hide();c.find("#main").show().css("visibility","")}c.find("#header #title").text("Settings");ManageUserSession.isActive()&&c.find("#header #done").show();b("#main")})}},m=function(b,c,d){n(b,c,true,d);LocalyticsManager.tagScreen(c)},o=function(){c.positionCenterOf(window)};return{show:function(){var e,
f;if(!d){d=true;c=$j("#app_settings");c.find("#main #connection #hostType").click(function(){m("#hosts","Login Host")});c.find("#hosts table td").click(function(){var b=$j(this);b.addClass("cellselected");ManageUserSession.setLoginHostType(this.id);k();setTimeout(function(){b.removeClass("cellselected")},100)});c.find("#main #connection #host_url input").focus(function(){h=true;$j(this).css("text-align","left")}).blur(function(){h=false;$j(this).val(ManageUserSession.getLoginHostUrl());$j(this).css("text-align",
"right");setTimeout(function(){$j(document.body).scrollTop(0)},10)});c.find("#main #connection #host_url form").submit(function(){var b=c.find("#main #connection #host_url input"),d=c.find("#main #connection #host_url input").val().trim();(d=d.length==0||d.endsWith(".salesforce.com"))||alert('Custom host url must end with ".salesforce.com".');if(d){ManageUserSession.setLoginHostUrl(b.val());k();b.blur()}return false});c.find("#main #help #help_about").click(function(){m("#about","About")});c.find("#main #help #help_faq").click(function(){m("#faq",
"FAQ",function(){})});c.find("#main #help #help_feedback").click(function(){location.href="mailto:"+feedbackEmail});c.find("#main #help #help_eula").click(function(){m("#eula","Contact Viewer EULA",l)});c.find("#loginbtn").off().click(function(){prepareSession()});c.find("#logoutbtn").off().click(function(){confirm("Logout user "+ManageUserSession.getUsername()+"?")&&logout(false)})}k();c.find("#header #title").text("Settings");c.find(".page").css("visibility","hidden");c.find("#main").css("visibility",
"visible");c.width()<500&&c.find("#header #left>div").text("Back");if(ManageUserSession.isActive()){c.find("#header #done").show();c.find("#loginbtn").hide();c.find("#logoutbtn").show()}else{c.find("#loginbtn").show();c.find("#logoutbtn").hide()}g=$j("#loggedin").addOverlay();c.find("#username").setText(ManageUserSession.getUsername()||"None");c.find("#header #done").off("click").enableTap().click(function(){SettingsManager.hide();$j(this).off("click");if(!ManageUserSession.isActive())window.location=
getBaseUrl()});ManageUserSession.isActive()||c.find("#header #done").hide();e=window.innerHeight;f=(window.innerHeight-c.height())/2;c.hide().css("zIndex",$j.topZIndex(g.elem)+10).css({left:(window.innerWidth-c.width())/2});useAnimations?c.css({top:0}).show().slideIn("Y",e,f):c.css({top:f}).show();b("#main");c.orientationChange(o);LocalyticsManager.tagScreen("Settings")},hide:function(b){var d=window.innerHeight,e=function(){c.hide();g.hide();typeof b=="function"&&b()};useAnimations?c.slideOut("Y",
d,e):e();j();c.unbindOrientationChange(o)},showEula:function(b,d){SettingsManager.show();n("#eula","End User License Agreement",false,function(){l(true);var e=c.find("#eula_buttons").show();e.find("#accept").off().enableTap().click(b);e.find("#decline").off().enableTap().click(d)});LocalyticsManager.tagScreen("EULA Request")},hideEula:function(){SettingsManager.hide(function(){if(useAnimations)c.find("#eula").changePage(c.find("#main"),true);else{c.find("#eula").hide();c.find("#main").show().css("visibility",
"")}c.find("#eula").css("visibility","hidden");c.find("#eula_buttons").hide();c.find("#header #title").text("Settings")})}}}(),FeedPhotoRenderer=function(){this.userIds=[]};FeedPhotoRenderer.prototype.getImage=function(b){this.userIds.push(b);return'<img class="feedImage app-images" id="photo__'+escape(b)+'"/>'};
FeedPhotoRenderer.prototype.renderImages=function(b){if(this.userIds.length!=0){b||(b=$j(document.body));hasChatterEnabled&&ManageUserSession.getApiClient().getUsersInfoViaApex(this.userIds,hasChatterEnabled,function(c){$j.each(c.records,function(){b.find("#photo__"+escape(this.Id)).removeClass("app-images").attr("src",this.SmallPhotoUrl)})},errorCallback)}};
function feedRenderer(b,c,d){var e=$j("#feedscroller #feed"),f=e.find("ul");f.empty();e.find("div").remove();if(!b||b.length==0)e.append($j('<div style="padding-top:20px"></div>').text(c));else{var g=new FeedPhotoRenderer,h=getFieldDescribe();$j.each(b,function(){var b=this.attributes.type;b=="ContactFeed"?generateChatterItem(this,f,g,h,d):b=="Task"&&generateTaskItem(this,f,g,d)});g.renderImages(f)}}
function generateChatterItem(b,c,d,e,f){var g=b.Body||"";b.Type=="TrackedChange"&&(b.FeedTrackedChanges&&b.FeedTrackedChanges.records)&&$j.each(b.FeedTrackedChanges.records,function(){if(this.FieldName=="created")g="created this "+contactLabel.toLowerCase()+".";else if(this.FieldName=="contactUpdatedByLead")g="updated this "+contactLabel.toLowerCase()+" by converting a lead.";else if(this.FieldName=="contactCreatedFromLead")g="converted a lead to this "+contactLabel.toLowerCase()+".";else if(this.NewValue!=
null||this.OldValue!=null){var b;if(b=e[this.FieldName.split(".")[1]]){b=b.label;g="updated "+b+" from "+(this.OldValue||"blank")+" to "+(this.NewValue||"blank")}}});if(g&&g.length>0){var h;if(f&&f.includeParent){h=$j('<span style="font-weight:bold"></span>').text(b.Parent.Name);h=$j('<a href="#"/>').attr("id","contact_"+htmlEncode(b.Parent.Id)).append(h);h[0].onclick=f.onClickParent}f=$j('<div class="feedBody"></div>').append(h).append(h?"&nbsp;-&nbsp;":"").append($j("<strong></strong>").text(b.CreatedBy.Name)).append("&nbsp;").append($j("<span></span>").text(g)).append('<br/><span class="datetime">'+
$j.format.date(b.CreatedDate,"MMM dd, yyyy (at) hh:mm a")+"</span>");$j("<li></li>").append(d.getImage(b.CreatedBy.Id)).append(f).appendTo(c)}}
function generateTaskItem(b,c,d,e){var f;if(e&&e.includeParent){f=$j('<span style="font-weight:bold"></span>').text(b.Who.Name);f=$j('<a href="#"/>').attr("id","contact_"+htmlEncode(b.Who.Id)).append(f);f[0].onclick=e.onClickParent}e=$j('<div class="feedBody"></div>').append(f).append(f?"&nbsp;-&nbsp;":"").append($j("<strong></strong>").text(b.Owner.Name)).append(" "+(b.IsClosed?"completed":"owns")+" the task<br/>").append($j("<span></span>").text(b.Subject||"")).append('<br/><span class="datetime">'+
(b.ActivityDate?"Due on "+$j.format.date(b.ActivityDate,"MMM dd, yyyy"):"No Due Date.")+"</span>");$j("<li></li>").append(d.getImage(b.Owner.Id)).append(e).appendTo(c)}
void 0===sforce.ListView&&(sforce.ListView=function(b){this.options={onListSelect:null,onSearch:null,onItemSelect:null,listTypes:{owner:"My Records",follow:"Records I Follow",recent:"Recently Viewed"}};for(i in this.options)this.options[i]=b[i];this.selectedContactId=b.selectedContactId;this.view=$j("#listpage");this._init()},sforce.ListView.prototype={_init:function(){var b=this,c=function(c){var e=b.view.find("#header #listselect");e.on("webkitTransitionEnd",function(){c&&c.hide();b.view.find("#header #searchbar").show();
e.off("webkitTransitionEnd").hide();e.css("zIndex","");e.prev().css("zIndex","");b.showingListSelector=false});e.css("-webkit-transform","translateY(-"+e.height()+"px)")};b._addSearchListeners();b.view.find("#header #titlebar").off().enableTap().click(function(){if(!b.showingListSelector){b.showingListSelector=true;var d=b.view.find("#header #listselect"),e=b.view.find("#listscroller").addOverlay(),f=$j.topZIndex(e.elem);d.prev().css("zIndex",f+2);d.css("zIndex",f+1);d.css(vendor+"TransitionProperty",
"").css("-webkit-transform","translateY(-"+d.height()+"px)");d.css(vendor+"TransitionProperty","-webkit-transform").css("visibility","hidden").show("fast",function(){b.view.find("#header #searchbar").hide();d.css("visibility","").css("-webkit-transform","translateY(0px)");d.find("button").windowTouch(function(d){d.preventDefault();d=d.target;b.view.find("#header #searchbar>form>input[type=search]").val("");b.view.find("#header #searchbar>form>button").hide();c(e);b.displayList(d.id);return true},
function(b){var d=b.target;if(d.nodeType==3)d=d.parentNode;var f=$j("#listpage");($j(d).is(f)||f.has(d).length>0)&&b.preventDefault();c(e);return true},true)})}});b.view.find("#listscroller #scroller #contactlist").off().click(function(c){var e=c.target;if(!b.loadingItem){e=$j(e).closest("li",b.view);c.preventDefault();e.length&&(!e.hasClass("listseparater")&&typeof b.options.onItemSelect=="function")&&b.selectContact(e[0].id.substring(8))}})},_addSearchListeners:function(){var b=this,c=function(){var b=
$j(this);b.val().length>0?b.next().show():b.next().hide()};b.view.find("#header #searchbar>form").submit(function(){var c=$j(this).find("input[type=search]").blur().val(),c=c.trim();if(c.length>1&&!c.startsWith("*")){b.searchTextLength=c.length;b.listFetchStartTime=Date.now();b.mode="search";b.view.find("#header #titlebar #title").html("Search Results");if(typeof b.options.onSearch=="function")b.options.onSearch(c)}return false});b.view.find("#header #searchbar>form>input[type=search]").focusin(function(){var b=
$j(this);b.windowTouch(function(){return false},function(){b.blur();return true},false)}).on("keydown",c).on("keyup",c);b.view.find("#header #searchbar #closebutton").off().enableTap().click(function(c){c.preventDefault();$j(this).hide().prev().val("").blur();if(b.mode=="search"){b.displayList(b.selectedListId);b.mode="list"}})},_initiateContactListScroller:function(b){var c=this;if(typeof b=="function")c.contactListPullDownCB=b;if(c.listpagescroll===void 0){c.listpagescroll=createScroller("listscroller",
function(){typeof c.contactListPullDownCB=="function"&&c.contactListPullDownCB()});$j(window).orientationChange(c._initiateContactListScroller)}else c.listpagescroll&&c.listpagescroll.refresh()},displayList:function(b,c){var d;this.listFetchStartTime=Date.now();d=b?this.view.find("#header #listselect button#"+b):this.view.find("#header #listselect button#recent");this.view.find("#header #titlebar #title").text(d.text());this.selectedListId=d[0].id;if(typeof this.options.onListSelect=="function")this.options.onListSelect(this.selectedListId,
c)},updateList:function(b){var c=this,d=c.view.find("#listscroller #scroller #contactlist"),e=c.view.find("#listscroller #scroller #resultCount");d.empty();e.empty();!b||b.length==0?e.text("No "+contactPluralLabel+" Found"):e.text("Found "+b.length+" "+contactPluralLabel);b.sort(function(b,c){var d=b.LastName.toLowerCase(),e=c.LastName.toLowerCase();return d==e?0:d>e?1:-1});var f=[];$j.each(b,function(){var b=htmlEncode(this.Id);if(f.length==0||this.LastName!=null&&f.last()!=this.LastName[0].toUpperCase()){f.push(this.LastName[0].toUpperCase());
$j("<li></li>").addClass("listseparater").text(f.last()).appendTo(d)}var e=$j("<li></li>").attr("id","contact_"+b);b==c.selectedContactId&&e.addClass("cellselected");e.text((this.FirstName||"")+" ").append($j("<strong></strong>").text(this.LastName||"")).appendTo(d)});c.mode=="search"?LocalyticsManager.tagSearch(c.searchTextLength,b.length,Date.now()-c.listFetchStartTime):LocalyticsManager.tagListView(this.selectedListId,b.length,Date.now()-c.listFetchStartTime)},resetSelectedContact:function(){this.selectedContactId=
null;this.view.find("#contactlist .cellselected").removeClass("cellselected")},selectContact:function(b){var c=this;c.resetSelectedContact();c.selectedContactId=b;c.view.find("#contactlist li#contact_"+b).addClass("cellselected");c.loadingItem=true;c.options.onItemSelect(c.selectedContactId,function(){c.loadingItem=false})},showBusyIndicator:function(b){this.busyInd=this.view.find("#listscroller").showActivityInd(b)},hideBusyIndicator:function(){this.busyInd&&this.busyInd.hide()},refreshScroller:function(b){this._initiateContactListScroller(b)}});
var ManageUserSession=function(){function b(b){g=true;h=b.username;j=b.eula;f.setSessionHeader(b.sessionToken);StorageManager.setSessionValue(e,b.sessionToken)}function c(){var b;switch(ManageUserSession.getLoginHostType()){case "host_production":b="login.salesforce.com";break;case "host_sandbox":b="test.salesforce.com";break;case "host_custom":b=StorageManager.getLocalValue(d)}if(!b||b.length==0)b="login.salesforce.com";return b}var d="SFDC-LOGIN-HOST-URL",e="SFDC-SESSION-TOKEN",f,g,h,j,k="standalone"in
navigator&&navigator.standalone;return{isActive:function(){return g==true},isEulaAccepted:function(){return j==true},updateEula:function(b){j=b},getClientId:function(){return g?StorageManager.getLocalValue("SFDC-CLIENT-ID"):null},getUsername:function(){return g?h:null},getApiClient:function(){return g?f:null},getLoginHostType:function(){return StorageManager.getLocalValue("SFDC-LOGIN-HOST")},getLoginHostUrl:c,setLoginHostType:function(b){b!=ManageUserSession.getLoginHostType()&&StorageManager.setLocalValue("SFDC-LOGIN-HOST",
b)},setLoginHostUrl:function(b){b=b.toLowerCase();if(c()!=b){var e="host_custom";switch(b){case "login.salesforce.com":e="host_production";break;case "test.salesforce.com":e="host_sandbox"}StorageManager.setLocalValue(d,b);ManageUserSession.setLoginHostType(e)}},initialize:function(c,d){f||(f=new sforce.Client);var h=StorageManager.getSessionValue(e),j=StorageManager.getLocalValue("SFDC-OAUTH-TOKEN");if(g)c();else if(h&&h.length>0){f.setSessionHeader(h);var p=function(){f.setSessionHeader(null);StorageManager.clearSessionValue(e);
ManageUserSession.initialize(c)};f.prepareSession(function(d){if(d.success){b(d);typeof c=="function"&&c()}else p()},p)}else if(j&&j.length>0)PasscodeManager.checkPasscode(function(d,e){if(d==-1)confirm("Logout user?")?logout(true):typeof e=="function"&&e(false);else{var g=$j(document).showActivityInd("Authenticating...",false),h=StorageManager.getLocalValue("SFDC-CLIENT-ID"),j=StorageManager.getLocalValue("SFDC-OAUTH-TOKEN");f.refreshAccessToken(d,h,j,function(d){if(d.success){b(d);typeof e=="function"&&
e(true);typeof c=="function"&&c()}else{d.errorCode=="INVALID_TOKEN"&&StorageManager.clearAll();typeof e=="function"&&e(d.success,d.error)}},function(b,c){typeof e=="function"&&e(false,c=="error"?"Server Unavailable. Check network connection or try again later.":"Request timed out. Please try again.")},g.hide)}});else if(window.location.search.indexOf("code=")>0){var r=/code=([^&]*)&?/.exec(window.location.search)[1],q=function(){history.pushState(null,null,window.location.pathname);c()},h=function(c,
d){var c=c==-1?void 0:c,e=$j(document).showActivityInd(c?"Setting Passcode...":"Authenticating...",false);f.obtainAccessToken(ManageUserSession.getLoginHostUrl(),r,c,function(f){e.hide();if(f.success){b(f);var g=f.clientId,f=c?f.refreshToken:null;g&&g.length>0&&StorageManager.setLocalValue("SFDC-CLIENT-ID",g);f&&f.length>0&&StorageManager.setLocalValue("SFDC-OAUTH-TOKEN",f);typeof q=="function"&&q()}else alert(f.error);typeof d=="function"&&d()},function(){if(confirm("Failed to obtain access. Try again!"))window.location=
f.getAuthorizeUrl(ManageUserSession.getLoginHostUrl())})};k?PasscodeManager.setupPasscode(h):h()}else{typeof d=="boolean"&&d&&StorageManager.clearAll();window.location=f.getAuthorizeUrl(ManageUserSession.getLoginHostUrl())}},invalidate:function(b,c){b&&g&&f.revokeSession(null,null,null,null,c);StorageManager.clearSessionValue(e);f=g=h=void 0},kill:function(b){var c=StorageManager.getLocalValue("SFDC-CLIENT-ID"),d=StorageManager.getLocalValue("SFDC-OAUTH-TOKEN");f.revokeSession(c,d,null,null,function(){ManageUserSession.invalidate();
StorageManager.clearAll();typeof b=="function"&&b()})}}}(),PasscodeManager=function(){var b,c,d=function(){var c=$j(window).height()/2-b.passcodeElem.outerHeight()/2,d=$j(window).width()/2-b.passcodeElem.outerWidth()/2;b.passcodeElem.css("top",c+"px").css("left",d+"px")},e=function(){if(window.innerHeight>window.innerWidth){var c=$j(window).height()-$j("#passcode table").outerHeight()+"px";b.passcodeElem.css("visibility","hidden").css("opacity","1").css(vendor+"Transform","translateY("+$j(window).height()+
"px)").show();b.passcodeElem.addClass("passcodeTransition").css("visibility","").css(vendor+"TransitionProperty","-"+vendor.toLowerCase()+"-transform");b.passcodeElem.css(vendor+"Transform","translateY("+c+")")}else{b.passcodeElem.css("visibility","hidden");setTimeout(function(){alert("Please switch to portrait mode to enter the passcode.")},0)}},f=function(){b.passcodeElem.css("opacity","0").show();setTimeout(function(){var c=Math.min(window.innerWidth,window.innerHeight);if(/ipad/gi.test(navigator.platform)||
c>$j("#passcode table").outerHeight()){b.passcodeElem.css("opacity","0");d();b.passcodeElem.addClass("passcodeTransition").css(vendor+"TransitionProperty","opacity").css("opacity","1");b.passcodeElem.orientationChange(d)}else{b.passcodeElem.orientationChange(e);e()}},0)},g=function(){var c;b.passcodeElem.bind("webkitTransitionEnd",function(){b.passcodeElem.removeClass("passcodeTransition").css(vendor+"TransitionProperty","none");b.passcodeElem.hide().unbind("webkitTransitionEnd");b&&b.passcodeElem&&
b.passcodeElem.unbindOrientationChange(d);b=void 0});if(/ipad/gi.test(navigator.platform)||$j(window).width()>$j("#passcode table").outerWidth()+50){c=void 0;b.passcodeElem.addClass("passcodeTransition").css(vendor+"TransitionProperty","opacity").css("opacity","0")}else{c=$j(window).height()+"px";b.passcodeElem.addClass("passcodeTransition").css(vendor+"TransitionProperty","-"+vendor.toLowerCase()+"-transform");b.passcodeElem.css(vendor+"Transform","translateY("+c+")")}},h=function(d){b={passcodeElem:$j("#passcode"),
inputElems:$j("#passcode #passcode_input input"),elemNum:0,passcode:"",callback:d};if(c===void 0){b.passcodeElem.find("table td.passcode_button").each(function(){var c=$j(this),d=c.text();c.touch(function(e){e.preventDefault();e.stopPropagation();if(b.elemNum<4){$j(c).addClass("pressed");setTimeout(function(){$j(c).removeClass("pressed")},100);if(d=="Logout"||d=="Cancel")b.callback(-1);else if(d=="Delete"){if(b.elemNum>0){b.inputElems[--b.elemNum].value="";b.passcode=b.passcode.substr(0,b.elemNum)}}else if(parseInt(d)>=
0){b.inputElems[b.elemNum++].value=".";b.passcode=b.passcode+d}b.elemNum==4&&b.callback&&b.callback(b.passcode)}})});c=true}l(b.title);j()},j=function(){l("Enter Passcode");$j("#passcode #passcode_message").empty().hide();$j("#passcode #passcode_header").removeClass("passcode_error");k()},k=function(){b.elemNum=0;b.passcode="";b.inputElems.val("")},l=function(b){$j("#passcode #passcode_title").html(b)};return{checkPasscode:function(c,d){h(function(b){var e=function(b,c){if(b){g();typeof d=="function"&&
d()}else{k();if(c){l("Wrong Passcode");$j("#passcode #passcode_message").html(c).show();$j("#passcode #passcode_header").addClass("passcode_error")}}};c&&c(b,e)});b.passcodeElem.find("#cancel").text("Logout");f()},setupPasscode:function(c){var d;h(function(e){if(e==-1){g();typeof c=="function"&&c(-1)}else if(d)if(d==e)typeof c=="function"&&c(b.passcode,g);else{d=void 0;alert("Passcode didn't match. Please try again.");j()}else{d=e;l("Re-enter the passcode");k()}});l("Setup Passcode");b.passcodeElem.find("#cancel").text("Cancel");
f()}}}();
void 0===sforce.SplitView&&(sforce.SplitView=function(){this.callbacks=$j.Callbacks();this._init()},sforce.SplitView.prototype={_init:function(){var b=this;isPortrait=function(){return window.innerHeight>window.innerWidth};var c=function(){switch(isPortrait()){case true:$j("#listpage").appendTo("#popover");$j("#popover").css("visibility","hidden").css("opacity","0").show();$j("#contactlist_button").show().text(contactPluralLabel).touch(function(){$j("#popover,#contactlist_button").windowTouch(function(){return false},function(){b.focusOutContactList();
return true},false);$j("#popover").css("visibility","").css("opacity","1")});break;case false:$j("#popover").hide();$j("#rightsection").before($j("#listpage"));$j("#contactlist_button").hide().unbindTouch();$j("#popover,#contactlist_button").unbindWindowTouch()}b.callbacks.fire(isPortrait())};$j(window).orientationChange(function(){(isPortrait()&&$j("#listpage").parent()[0].id!="popover"||!isPortrait()&&$j("#listpage").parent()[0].id=="popover")&&c()});c()},focusOutContactList:function(){switch(window.innerHeight>
window.innerWidth){case true:var b=$j("#popover"),c=function(){b.css("visibility","hidden").unbind("webkitTransitionEnd")};b.css("opacity")!="0"&&b.bind("webkitTransitionEnd",c);b.css("opacity","0");$j("#popover,#contactlist_button").unbindWindowTouch()}},addOrientationChangeCallback:function(b){typeof b=="function"&&this.callbacks.add(b)},removeOrientationChangeCallback:function(b){typeof b=="function"&&this.callbacks.remove(b)}});
var StorageManager=function(){return{checkLocalStorage:function(){return typeof localStorage=="undefined"?false:true},checkSessionStorage:function(){return typeof sessionStorage=="undefined"?false:true},clearAll:function(){this.checkLocalStorage()&&localStorage.clear();this.checkSessionStorage()&&sessionStorage.clear()},setLocalValue:function(b,c){this.checkLocalStorage()&&localStorage.setItem(b,c)},getLocalValue:function(b){if(this.checkLocalStorage())return localStorage.getItem(b)},clearLocalValue:function(b){this.checkLocalStorage()&&
localStorage.removeItem(b)},setSessionValue:function(b,c){this.checkSessionStorage()&&sessionStorage.setItem(b,c)},getSessionValue:function(b){if(this.checkSessionStorage())return sessionStorage.getItem(b)},clearSessionValue:function(b){this.checkSessionStorage()&&sessionStorage.removeItem(b)}}}();
(function(){var b,c,d,e;b=function(){};e={Call:{href:"tel:${target}"},Message:{href:"sms:${target}"},Skype:{href:"skype:${target}?call"},Facetime:{href:"facetime://${target}"},Email:{href:"mailto:${target}"},Map:{href:"https://maps.google.com/maps?q=${target}"}};c=["Call","Message","Skype","Facetime"];d=["Email","Facetime"];b.prototype.getTargetType=function(b){return/^tel:/.test(b)?"phone":/^mailto:/.test(b)?"email":null};b.prototype.getTarget=function(b,c){var d="#";if(b){switch(this.getTargetType(c)){case "phone":d=
c.substring(4);break;case "email":d=c.substring(7)}d=b.replace("${target}",d)}return d};b.prototype.getActions=function(b){switch(this.getTargetType(b)){case "phone":return c;case "email":return d}return[]};b.prototype.handleAction=function(b,c){if(e[b].call){switch(this.getTargetType(c)){case "phone":c=c.substring(4);break;case "email":c=c.substring(7);break;case "address":c=c.substring(c.indexOf("?q=")+3)}e[b].call.apply(this,[c])}};b.prototype.attachHandler=function(b){var c=this,d;d=function(b){var d,
f,h=[],m=this.href,o=c.getActions(m);b.preventDefault();a=true;d=$j("body").addOverlay();o.forEach(function(b){h.push('<a id="'+b+'" ');h.push('href="'+c.getTarget(e[b].href,m)+'" ');h.push('class="button">'+b+"</a>")});h.push('<div id="cancel" class="button">Cancel</div>');f=$j('<div class="actionSheet"></div>').css("visibility","hidden").css("zIndex",$j.topZIndex(d.elem)+10).append(h.join("")).appendTo("body");f.find(".button").enableTap().click(function(){var b=function(){f.remove();d.hide()};
useAnimations?f.slideOut("Y",window.innerHeight,b):b();this.id!="cancel"&&window.ActionManager.handleAction(this.id,m)});useAnimations?f.slideIn("Y",window.innerHeight,window.innerHeight-f.outerHeight()):f.css({top:window.innerHeight-f.outerHeight(),visibility:""})};b.each(function(){var b=this.href,f=c.getActions(b);if(f.length>1)$j(this).click(d);else if(f.length==1){this.href=c.getTarget(e[f[0]].href,b);$j(this).click(function(){window.ActionManager.handleAction(f[0],b)})}})};window.ActionManager=
new b})();void 0===window.LocalyticsManager&&(window.LocalyticsManager=function(){localyticsSession.init(localyticsAppId);localyticsSession.open();localyticsSession.upload();this.uploadTimer=setInterval(localyticsSession.upload,3E4)},window.LocalyticsManager());
void 0!=window.LocalyticsManager&&function(){var b=function(b){return b<100?"< 100":b<200?"100 - 200":b<500?"200 - 500":"> 500"},c=function(b,c){if(!c||!c.length)c=[500,1E3,2E3];for(var f in c)if(b<c[f])return(f==0?"< ":c[f-1]/1E3+" - ")+c[f]/1E3+"s";return">"+c[c.length-1]};LocalyticsManager.tagScreen=function(b){localyticsSession.tagScreen(b)};LocalyticsManager.tagScreenOrientation=function(b){this.tagScreen(b?"Portrait":"Landscape")};LocalyticsManager.tagEvent=function(b,c){localyticsSession.tagEvent(b,
c)};LocalyticsManager.tagListView=function(d,e,f){this.tagEvent("Render List",{list:d,resultsetSize:b(e),loadTimeRange:c(f),loadTime:f})};LocalyticsManager.tagSearch=function(d,e,f){this.tagEvent("Search",{textLength:d<3?"< 3":d<5?"3 - 5":"> 5",resultsetSize:b(e),loadTimeRange:c(f),loadTime:f})};LocalyticsManager.tagDetailView=function(b,e){this.tagEvent("Render Detail",{view:b,loadTimeRange:c(e),loadTime:e})};LocalyticsManager.logAppStarted=function(){this.appStartTime=Date.now()};LocalyticsManager.logAuthComplete=
function(){if(!this.appStartTime)this.appStartTime=Date.now();this.appAuthTime=Date.now()};LocalyticsManager.logAppReady=function(){var b,e;this.appAuthTime&&(b=Date.now()-this.appStartTime);e=Date.now()-this.appAuthTime;this.tagEvent("App Ready",{authTime:b,dataLoadTime:e,authTimeRange:c(b,[2E3,5E3,1E4]),dataLoadTimeRange:c(e,[2E3,5E3,1E4]),totalLoadTimeRange:c(b+e,[5E3,1E4,15E3])})}}();