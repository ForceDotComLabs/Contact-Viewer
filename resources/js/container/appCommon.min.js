/*Copyright (c) 2011, salesforce.com <http://salesforce.com> , inc.*/
void 0===window.$j&&($j=$.noConflict());var sforce=window.sforce;void 0===sforce&&(sforce={});String.prototype.startsWith=function(a){return this.substr(0,a.length)===a};String.prototype.endsWith=function(a){return this.substr(this.length-a.length,this.length)===a};Array.prototype.last=function(){return this[this.length-1]};function htmlEncode(a){return a?$j("<div/>").text(a).html():a}function htmlDecode(a){return a?$j("<div/>").html(a).text():a}
function formatStr(a,b){a&&(a=htmlEncode(a));return a&&b&&a.length>b?a.substr(0,b-3)+"...":a}function cleanupPhone(a){return a?(a=htmlEncode(a),(a.trim().startsWith("+")?"+":"")+a.replace(/[^0-9]/g,"")):a}
function formatAddress(a){return(a.MailingStreet?htmlEncode(a.MailingStreet).replace(/\n/g,", ")+"\n":"")+(a.MailingCity?htmlEncode(a.MailingCity).replace(/\n/g,", ")+", ":"")+(a.MailingState?htmlEncode(a.MailingState).replace(/\n/g,", ")+" ":"")+(a.MailingPostalCode?htmlEncode(a.MailingPostalCode).replace(/\n/g,", ")+" ":"")+(a.MailingCountry?htmlEncode(a.MailingCountry).replace(/\n/g,""):"")}function getBaseUrl(){return siteUrl.endsWith("/")?siteUrl.substring(0,siteUrl.length-1):siteUrl}
function getFieldDescribe(){return eval("("+StorageManager.getSessionValue(contact_describe_storage_key)+")")}function truncateLongText(){}function isPortrait(){return window.innerHeight>window.innerWidth}var contact_describe_storage_key="SFDC-CONTACT-DESCRIBE";
function fetchContactDescribe(a){ManageUserSession.getApiClient().describeContactViaApex(function(a){contactLabel=a.label||"Contact";contactPluralLabel=a.labelPlural||"Contacts";if(a.fields){var d={};$j.each(a.fields,function(){var a={label:this.label,type:this.type,length:this.length};d[this.name]=a;"reference"==a.type&&(a.relationshipName=this.relationshipName,a.referenceTo=this.referenceTo,a.relationshipLabel=this.relationshipLabel||"",d[this.relationshipName]=a)});StorageManager.setSessionValue(contact_describe_storage_key,
JSON.stringify(d))}a.recordTypeInfos&&1<a.recordTypeInfos.length&&(hasRecordTypes=!0);a.childRelationships&&(hasChatterEnabled=a.childRelationships.some(function(a){return"ContactFeed"==a.childSObject}))},errorCallback,function(b,d){"function"==typeof a&&a("success"==d)})}
function createScroller(a,b,d){var c,e,f,g,a="object"==typeof a?a:$j("#"+a);if(b){var h=a.find("#pullDown")[0];h||($j(a.children().children().get(0)).before('<div id="pullDown"><span class="app-images appleui pullDownIcon"></span><span class="pullDownLabel">Pull down to refresh</span> </div>'),h=a.find("#pullDown")[0]);c=h.offsetHeight;e=function(){if(h.className.match("loading")){h.className="";h.querySelector(".pullDownLabel").innerHTML="Pull down to refresh"}};f=function(){if(this.y>5&&!h.className.match("flip")){h.className=
"flip";h.querySelector(".pullDownLabel").innerHTML="Release to refresh";this.minScrollY=0}else if(this.y<5&&h.className.match("flip")){h.className="";h.querySelector(".pullDownLabel").innerHTML="Pull down to refresh";this.minScrollY=-c}};g=function(){if(h.className.match("flip")){h.className="loading";h.querySelector(".pullDownLabel").innerHTML="Loading...";b()}}}var j={useTransition:!0,topOffset:c||0};d&&d.onBeforeScrollStart&&(j.onBeforeScrollStart=d.onBeforeScrollStart);e&&(j.onRefresh=e);f&&(j.onScrollMove=
f);g&&(j.onScrollEnd=g);return new iScroll(a[0],j)}
function errorCallback(a,b){if("error"==b){var d=a.responseText;try{d=$j.parseJSON(d)}catch(c){}switch(a.status){case 403:if(/NO_API_ACCESS/gi.test(a.responseText)&&ManageUserSession.isActive()){alert(d.message);logout(!0);break}case 401:alert(d.message||"Session expired. Please relogin.");ManageUserSession.invalidate(!0,function(){window.location.reload()});break;default:alert("Server Unavailable. Check network connection or try again later.")}}else b="timeout",alert("Session timed out."),ManageUserSession.invalidate(!0,
function(){window.location.reload()})}var last_visited_loc_storage_key="LAST-VISIT-LOC";function updateLastVisitLoc(a){a?StorageManager.setLocalValue(last_visited_loc_storage_key,a):StorageManager.clearLocalValue(last_visited_loc_storage_key)}
function getEulaResponse(a){SettingsManager.showEula(function(){ManageUserSession.getApiClient().submitEulaResponse(ManageUserSession.getClientId(),this.id,function(b){b.success&&"true"==b.success?(ManageUserSession.updateEula(!0),SettingsManager.hideEula(),"function"==typeof a&&a()):(b.error&&alert(b.error),b.errorCode&&"INVALID_CLIENT"==b.errorCode&&logout(!1))},errorCallback)},function(){logout(!0)})}
function logout(a){ManageUserSession.kill(function(){a||StorageManager.setSessionValue(login_redirect_storage_key,!1);window.location=getBaseUrl()})}
function getContacts(a,b){listView.showBusyIndicator("Loading...");ManageUserSession.getApiClient().queryContactsViaApex(a,function(a){sobjectModel.setRecords(a.records)},errorCallback,function(d,c){listView.updateList(sobjectModel.records);listView.hideBusyIndicator();listView.refreshScroller(function(){getContacts(a)});"function"==typeof b&&b("success"==c)})}
function searchContacts(a,b){listView.showBusyIndicator("Searching...");ManageUserSession.getApiClient().searchContactsViaApex(a,function(a){sobjectModel.setRecords(a)},errorCallback,function(d,c){listView.updateList(sobjectModel.records);listView.hideBusyIndicator();listView.refreshScroller(function(){searchContacts(a)});"function"==typeof b&&b(c)})}
function prepareSession(a){"false"==StorageManager.getSessionValue(login_redirect_storage_key)?(StorageManager.clearSessionValue(login_redirect_storage_key),setTimeout(SettingsManager.show,10)):ManageUserSession.initialize(function(){ManageUserSession.isEulaAccepted()?sessionCallback():getEulaResponse(sessionCallback)},a)}
void 0===sforce.Client&&(sforce.Client=function(){this.sessionHeader=null;this.SESSION_HEADER="App-Session"},sforce.Client.prototype.ajax=function(a,b,d,c,e,f){var g=this;$j.ajax({type:a,url:b,processData:!0,data:d,dataType:"json",success:c,error:e,complete:f,beforeSend:function(a){g.sessionHeader&&a.setRequestHeader(g.SESSION_HEADER,g.sessionHeader)}})},sforce.Client.prototype.setSessionHeader=function(a){this.sessionHeader=a},sforce.Client.prototype.getAuthorizeUrl=function(a){return getBaseUrl()+
"/services/apexrest/oauth2/?doAuthorize&host="+a},sforce.Client.prototype.refreshAccessToken=function(a,b,d,c,e,f){var g=getBaseUrl()+"/services/apexrest/oauth2/refreshAccess";this.ajax("POST",g,"rt="+d+"&pass="+a+"&cid="+b,c,e,f)},sforce.Client.prototype.obtainAccessToken=function(a,b,d,c,e,f){var g=getBaseUrl()+"/services/apexrest/oauth2/authenticate";this.ajax("POST",g,"code="+b+(d?"&pass="+d:"")+(a?"&host="+a:""),c,e,f)},sforce.Client.prototype.prepareSession=function(a,b,d){var c=getBaseUrl()+
"/services/apexrest/oauth2/prepareSession";this.ajax("POST",c,null,a,b,d)},sforce.Client.prototype.prepareSessionFromOAuth=function(a,b,d,c,e,f){var g=getBaseUrl()+"/services/apexrest/oauth2/prepareSession";this.ajax("POST",g,"accessToken="+a+"&instanceUrl="+b+"&identityUrl="+d,c,e,f)},sforce.Client.prototype.revokeSession=function(a,b,d,c,e){var f=getBaseUrl()+"/services/apexrest/oauth2/revokeSession";this.ajax("POST",f,a&&b?"cid="+a+"&rt="+b:"",d,c,e)},sforce.Client.prototype.queryContactsViaApex=
function(a,b,d,c){var e=getBaseUrl()+"/services/apexrest/cvapi";this.ajax("GET",e,"action=fetchContacts&filter="+a,b,d,c)},sforce.Client.prototype.retrieveContactViaApex=function(a,b,d,c,e){var f=getBaseUrl()+"/services/apexrest/cvapi";this.ajax("GET",f,"action=retrieveContact&id="+a+"&fields="+b,d,c,e)},sforce.Client.prototype.searchContactsViaApex=function(a,b,d,c){var e=getBaseUrl()+"/services/apexrest/cvapi";this.ajax("GET",e,"action=searchContacts&text="+a,b,d,c)},sforce.Client.prototype.fetchChatterViaApex=
function(a,b,d,c){var e=getBaseUrl()+"/services/apexrest/cvapi";this.ajax("GET",e,"action=fetchChatter&ids="+a,b,d,c)},sforce.Client.prototype.fetchActivitiesViaApex=function(a,b,d,c){var e=getBaseUrl()+"/services/apexrest/cvapi";this.ajax("GET",e,"action=fetchActivities&ids="+a,b,d,c)},sforce.Client.prototype.getUsersInfoViaApex=function(a,b,d,c,e){var f=getBaseUrl()+"/services/apexrest/cvapi";this.ajax("GET",f,"action=getUsersInfo&id="+a+"&fetchPhotos="+b,d,c,e)},sforce.Client.prototype.describeContactViaApex=
function(a,b,d){var c=getBaseUrl()+"/services/apexrest/cvapi";this.ajax("GET",c,"action=describeContact",a,b,d)},sforce.Client.prototype.getContactDetailsViaApex=function(a,b,d,c,e){var f=this,g=getBaseUrl()+"/ContactDetails",h=(new Date).getTimezoneOffset();$j.ajax({type:"GET",url:g,data:"id="+a+"&rtid="+(b||"")+"&tzOffset="+h,success:d,error:c,complete:e,beforeSend:function(a){f.sessionHeader&&a.setRequestHeader(f.SESSION_HEADER,f.sessionHeader)}})},sforce.Client.prototype.getContactAppEula=function(a,
b,d){var c=getBaseUrl()+"/ContactsAppEula";$j.ajax({type:"GET",url:c,success:a,error:b,complete:d})},sforce.Client.prototype.submitEulaResponse=function(a,b,d,c,e){var f=getBaseUrl()+"/services/apexrest/cvapi";this.ajax("GET",f,"action=manageEula&clientId="+a+"&eulaResponse="+b,d,c,e)});
var SettingsManager=function(){function a(d){if(d&&e!=d){c&&h();c=createScroller(b.find(".settings_body "+d));e=d;$j(window).orientationChange(function(){a()})}else c&&c.refresh()}var b,d,c,e,f,g=false,h=function(){if(c){c.destroy();e=c=void 0}},j=function(){var a=ManageUserSession.getLoginHostType();if(!a){a=b.find("#hosts table td")[0].id;ManageUserSession.setLoginHostType(a)}if(a){b.find("#connection #hostType #name").text(b.find("#hosts #"+a+" span").text());b.find("#hosts table td").css("color",
"black");b.find("#hosts #"+a).css("color","#395483").append(b.find("#hosts #check"))}b.find("#main #connection #host_url input").val(ManageUserSession.getLoginHostUrl())},k=function(d,c){ManageUserSession.getApiClient().getContactAppEula(function(a){a=$j(a);a.find("head, script").remove();b.find("#eula .content").empty().append(a);if(d){a=b.find("#eula_buttons").show();b.find("#eula").css("margin-bottom",a.outerHeight()+"px")}else b.find("#eula").css("margin-bottom","0")},errorCallback,function(b,
d){a("#eula");typeof c=="function"&&c(d)})},l=function(d,c,e,f){var h=$j(this),j;g&&setTimeout(function(){b.find("#main #connection #host_url input").blur()},10);h.addClass("cellselected");b.find("#header #done").hide();j=function(){h.removeClass("cellselected");b.find("#main").css("visibility","hidden");typeof f=="function"&&f()};if(useAnimations)b.find("#main").changePage(b.find(d),false,j);else{b.find("#main").hide();b.find(d).show().css("visibility","");j()}b.find("#header #title").text(c);a(d);
if(e){var k=b.find(d);b.find("#header #left").show().touch(function(){b.find("#header #left").hide().off();if(useAnimations)k.changePage(b.find("#main"),true,function(){k.css("visibility","hidden")});else{k.hide();b.find("#main").show().css("visibility","")}b.find("#header #title").text("Settings");ManageUserSession.isActive()&&b.find("#header #done").show();a("#main")})}},m=function(){b.positionCenterOf(window)};return{show:function(){var c,e;if(!d){d=true;b=$j("#app_settings");b.find("#main #connection #hostType").enableTap().click(function(){l("#hosts",
"Login Host",true,void 0)});b.find("#hosts table td").enableTap().click(function(){var a=$j(this);a.addClass("cellselected");ManageUserSession.setLoginHostType(this.id);j();setTimeout(function(){a.removeClass("cellselected")},100)});b.find("#main #connection #host_url input").focus(function(){g=true;$j(this).css("text-align","left")}).blur(function(){g=false;$j(this).val(ManageUserSession.getLoginHostUrl());$j(this).css("text-align","right");setTimeout(function(){$j(document.body).scrollTop(0)},10)});
b.find("#main #connection #host_url form").submit(function(){var a=b.find("#main #connection #host_url input"),d=b.find("#main #connection #host_url input").val().trim();(d=d.length==0||d.endsWith(".salesforce.com"))||alert('Custom host url must end with ".salesforce.com".');if(d){ManageUserSession.setLoginHostUrl(a.val());j();a.blur()}return false});b.find("#main #help #help_about").enableTap().click(function(){l("#about","About",true,void 0)});b.find("#main #help #help_faq").enableTap().click(function(){l("#faq",
"FAQ",true,function(){})});b.find("#main #help #help_eula").enableTap().click(function(){l("#eula","Contact Viewer EULA",true,k)});b.find("#loginbtn").off().enableTap().click(function(){prepareSession()});b.find("#logoutbtn").off().enableTap().click(function(){confirm("Logout user "+ManageUserSession.getUsername()+"?")&&logout(false)})}j();b.find("#header #title").text("Settings");b.find(".page").css("visibility","hidden");b.find("#main").css("visibility","visible");b.width()<500&&b.find("#header #left>div").text("Back");
if(ManageUserSession.isActive()){b.find("#header #done").show();b.find("#loginbtn").hide();b.find("#logoutbtn").show()}else{b.find("#loginbtn").show();b.find("#logoutbtn").hide()}f=$j("#loggedin").addOverlay();b.find("#username").setText(ManageUserSession.getUsername()||"None");b.find("#header #done").off("click").enableTap().click(function(){SettingsManager.hide();$j(this).off("click");if(!ManageUserSession.isActive())window.location=getBaseUrl()});ManageUserSession.isActive()||b.find("#header #done").hide();
c=window.innerHeight;e=(window.innerHeight-b.height())/2;b.hide().css("zIndex",$j.topZIndex(f.elem)+10).css({left:(window.innerWidth-b.width())/2});useAnimations?b.css({top:0}).show().slideIn("Y",c,e):b.css({top:e}).show();a("#main");b.orientationChange(m)},hide:function(a){var d=window.innerHeight,c=function(){b.hide();f.hide();typeof a=="function"&&a()};useAnimations?b.slideOut("Y",d,c):c();h();b.unbindOrientationChange(m)},showEula:function(a,d){SettingsManager.show();l("#eula","End User License Agreement",
false,function(){k(true);var c=b.find("#eula_buttons").show();c.find("#accept").off().enableTap().click(a);c.find("#decline").off().enableTap().click(d)})},hideEula:function(){SettingsManager.hide(function(){if(useAnimations)b.find("#eula").changePage(b.find("#main"),true);else{b.find("#eula").hide();b.find("#main").show().css("visibility","")}b.find("#eula").css("visibility","hidden");b.find("#eula_buttons").hide();b.find("#header #title").text("Settings")})}}}(),FeedPhotoRenderer=function(){this.userIds=
[]};FeedPhotoRenderer.prototype.getImage=function(a){this.userIds.push(a);return'<img class="feedImage app-images" id="photo__'+escape(a)+'"/>'};FeedPhotoRenderer.prototype.renderImages=function(a){if(this.userIds.length!=0){a||(a=$j(document.body));hasChatterEnabled&&ManageUserSession.getApiClient().getUsersInfoViaApex(this.userIds,hasChatterEnabled,function(b){$j.each(b.records,function(){a.find("#photo__"+escape(this.Id)).removeClass("app-images").attr("src",this.SmallPhotoUrl)})},errorCallback)}};
function feedRenderer(a,b,d){var c=$j("#feedscroller #feed"),e=c.find("ul");e.empty();c.find("div").remove();if(!a||a.length==0)c.append($j('<div style="padding-top:20px"></div>').text(b));else{var f=new FeedPhotoRenderer,g=getFieldDescribe();$j.each(a,function(){var a=this.attributes.type;a=="ContactFeed"?generateChatterItem(this,e,f,g,d):a=="Task"&&generateTaskItem(this,e,f,d)});f.renderImages(e)}}
function generateChatterItem(a,b,d,c,e){var f=a.Body||"";a.Type=="TrackedChange"&&(a.FeedTrackedChanges&&a.FeedTrackedChanges.records)&&$j.each(a.FeedTrackedChanges.records,function(){if(this.FieldName=="created")f="created this "+contactLabel.toLowerCase()+".";else if(this.FieldName=="contactUpdatedByLead")f="updated this "+contactLabel.toLowerCase()+" by converting a lead.";else if(this.FieldName=="contactCreatedFromLead")f="converted a lead to this "+contactLabel.toLowerCase()+".";else if(this.NewValue!=
null||this.OldValue!=null){var a;if(a=c[this.FieldName.split(".")[1]]){a=a.label;f="updated "+a+" from "+(this.OldValue||"blank")+" to "+(this.NewValue||"blank")}}});if(f&&f.length>0){var g;if(e&&e.includeParent){g=$j('<span style="font-weight:bold"></span>').text(a.Parent.Name);g=$j('<a href="#"/>').attr("id","contact_"+htmlEncode(a.Parent.Id)).append(g);g[0].onclick=e.onClickParent}e=$j('<div class="feedBody"></div>').append(g).append(g?"&nbsp;-&nbsp;":"").append($j("<strong></strong>").text(a.CreatedBy.Name)).append("&nbsp;").append($j("<span></span>").text(f)).append('<br/><span class="datetime">'+
$j.format.date(a.CreatedDate,"MMM dd, yyyy (at) hh:mm a")+"</span>");$j("<li></li>").append(d.getImage(a.CreatedBy.Id)).append(e).appendTo(b)}}
function generateTaskItem(a,b,d,c){var e;if(c&&c.includeParent){e=$j('<span style="font-weight:bold"></span>').text(a.Who.Name);e=$j('<a href="#"/>').attr("id","contact_"+htmlEncode(a.Who.Id)).append(e);e[0].onclick=c.onClickParent}c=$j('<div class="feedBody"></div>').append(e).append(e?"&nbsp;-&nbsp;":"").append($j("<strong></strong>").text(a.Owner.Name)).append(" "+(a.IsClosed?"completed":"owns")+" the task<br/>").append($j("<span></span>").text(a.Subject||"")).append('<br/><span class="datetime">'+
(a.ActivityDate?"Due on "+$j.format.date(a.ActivityDate,"MMM dd, yyyy"):"No Due Date.")+"</span>");$j("<li></li>").append(d.getImage(a.Owner.Id)).append(c).appendTo(b)}
void 0===sforce.ListView&&(sforce.ListView=function(a){this.options={onListSelect:null,onSearch:null,onItemSelect:null,listTypes:{owner:"My Records",follow:"Records I Follow",recent:"Recently Viewed"}};for(i in this.options)this.options[i]=a[i];this.selectedContactId=a.selectedContactId;this.view=$j("#listpage");this._init()},sforce.ListView.prototype={_init:function(){var a=this,b=function(b){var c=a.view.find("#header #listselect");c.on("webkitTransitionEnd",function(){b&&b.hide();a.view.find("#header #searchbar").show();
c.off("webkitTransitionEnd").hide();c.css("zIndex","");c.prev().css("zIndex","");a.showingListSelector=false});c.css("-webkit-transform","translateY(-"+c.height()+"px)")};a._addSearchListeners();a.view.find("#header #titlebar").off().enableTap().click(function(){if(!a.showingListSelector){a.showingListSelector=true;var d=a.view.find("#header #listselect"),c=a.view.find("#listscroller").addOverlay(),e=$j.topZIndex(c.elem);d.prev().css("zIndex",e+2);d.css("zIndex",e+1);d.css(vendor+"TransitionProperty",
"").css("-webkit-transform","translateY(-"+d.height()+"px)");d.css(vendor+"TransitionProperty","-webkit-transform").css("visibility","hidden").show("fast",function(){a.view.find("#header #searchbar").hide();d.css("visibility","").css("-webkit-transform","translateY(0px)");d.find("button").windowTouch(function(d){d.preventDefault();d=d.target;a.view.find("#header #searchbar>form>input[type=search]").val("");a.view.find("#header #searchbar>form>button").hide();b(c);a._displayList(d.id);return true},
function(a){var d=a.target;if(d.nodeType==3)d=d.parentNode;var e=$j("#listpage");($j(d).is(e)||e.has(d).length>0)&&a.preventDefault();b(c);return true},true)})}});a.view.find("#listscroller #scroller #contactlist").off().enableTap().click(function(b){var c=b.target;if(!a.loadingItem){c=$j(c).closest("li",a.view);b.preventDefault();c.length&&(!c.hasClass("listseparater")&&typeof a.options.onItemSelect=="function")&&a.selectContact(c[0].id.substring(8))}})},_addSearchListeners:function(){var a=this,
b=function(){var a=$j(this);a.val().length>0?a.next().show():a.next().hide()};a.view.find("#header #searchbar>form").submit(function(){var b=$j(this).find("input[type=search]").blur().val(),b=b.trim();if(b.length>1&&!b.startsWith("*")){a.mode="search";a.view.find("#header #titlebar #title").html("Search Results");if(typeof a.options.onSearch=="function")a.options.onSearch(b)}return false});a.view.find("#header #searchbar>form>input[type=search]").focusin(function(){var a=$j(this);a.windowTouch(function(){return false},
function(){a.blur();return true},false)}).on("keydown",b).on("keyup",b);a.view.find("#header #searchbar #closebutton").off().enableTap().click(function(b){b.preventDefault();$j(this).hide().prev().val("").blur();if(a.mode=="search"){a._displayList(a.selectedListId);a.mode="list"}})},_displayList:function(a){a=a?this.view.find("#header #listselect button#"+a):this.view.find("#header #listselect button#recent");this.view.find("#header #titlebar #title").text(a.text());this.selectedListId=a[0].id;if(typeof this.options.onListSelect==
"function")this.options.onListSelect(this.selectedListId)},_initiateContactListScroller:function(a){var b=this;if(typeof a=="function")b.contactListPullDownCB=a;if(b.listpagescroll===void 0){b.listpagescroll=createScroller("listscroller",function(){typeof b.contactListPullDownCB=="function"&&b.contactListPullDownCB()});$j(window).orientationChange(b._initiateContactListScroller)}else b.listpagescroll&&b.listpagescroll.refresh()},updateList:function(a){var b=this,d=b.view.find("#listscroller #scroller #contactlist"),
c=b.view.find("#listscroller #scroller #resultCount");d.empty();c.empty();!a||a.length==0?c.text("No "+contactPluralLabel+" Found"):c.text("Found "+a.length+" "+contactPluralLabel);a.sort(function(a,b){var d=a.LastName.toLowerCase(),c=b.LastName.toLowerCase();return d==c?0:d>c?1:-1});var e=[];$j.each(a,function(){var a=htmlEncode(this.Id);if(e.length==0||this.LastName!=null&&e.last()!=this.LastName[0].toUpperCase()){e.push(this.LastName[0].toUpperCase());$j("<li></li>").addClass("listseparater").text(e.last()).appendTo(d)}var c=
$j("<li></li>").attr("id","contact_"+a);a==b.selectedContactId&&c.addClass("cellselected");c.text((this.FirstName||"")+" ").append($j("<strong></strong>").text(this.LastName||"")).appendTo(d)})},resetSelectedContact:function(){this.selectedContactId=null;this.view.find("#contactlist .cellselected").removeClass("cellselected")},selectContact:function(a){var b=this;b.resetSelectedContact();b.selectedContactId=a;b.view.find("#contactlist li#contact_"+a).addClass("cellselected");b.loadingItem=true;b.options.onItemSelect(b.selectedContactId,
function(){b.loadingItem=false})},showBusyIndicator:function(a){this.busyInd=this.view.find("#listscroller").showActivityInd(a)},hideBusyIndicator:function(){this.busyInd&&this.busyInd.hide()},refreshScroller:function(a){this._initiateContactListScroller(a)}});
var ManageUserSession=function(){var a,b,d,c;return{isActive:function(){return b==true},isEulaAccepted:function(){return true},updateEula:function(){},getUsername:function(){return b?d:null},getApiClient:function(){return b?a:null},getLoginHostType:function(){return c.toLowerCase().indexOf("login.")==0?"host_production":c.toLowerCase().indexOf("test.")==0?"host_sandbox":"host_custom"},getLoginHostUrl:function(){return c},setLoginHostType:function(a){a.toLowerCase()=="host_production"?ManageUserSession.setLoginHostUrl("login.salesforce.com"):
a.toLowerCase()=="host_sandbox"?ManageUserSession.setLoginHostUrl("test.salesforce.com"):a.toLowerCase()=="host_custom"&&(c="")},setLoginHostUrl:function(a){a=a.toLowerCase();if(!b||c!=a&&confirm("Changing login host will logout the current logged in user. Are you sure you want to continue?")){c=a;SalesforceOAuthPlugin.setLoginDomain(null,null,c);b&&ManageUserSession.kill()}},initialize:function(e){if(b)e();else{var f,g,h,j;f=$j(document).showActivityInd("Authenticating...",false);g=new OAuthProperties(remoteAccessConsumerKey,
oauthRedirectURI,["api"],true,true);h=function(c){var e=function(e){if(e.success){b=true;d=e.username;a.setSessionHeader(e.sessionToken);f.hide();typeof c=="function"&&c()}else j()};return function(b){a.prepareSessionFromOAuth(b.accessToken,b.instanceUrl,b.identityUrl,e,j)}};j=function(a){SFHybridApp.logError("loginFailure: "+a);f.hide();confirm("Authentication failed. Do you want to retry?")&&ManageUserSession.initialize(e)};SalesforceOAuthPlugin.authenticate(h(e),j,g);$j(document).off("salesforceSessionRefresh").on("salesforceSessionRefresh",
function(a){h()(a.originalEvent.data)});SalesforceOAuthPlugin.getLoginDomain(function(a){c=a.toLowerCase()});a||(a=new sforce.Client)}},invalidate:function(c,f){c&&b&&a.revokeSession(null,null,null,null,f);a=b=d=void 0},kill:function(){if(b){ManageUserSession.invalidate();SalesforceOAuthPlugin.logout()}}}}();
void 0===sforce.SplitView&&(sforce.SplitView=function(){this.callbacks=$j.Callbacks();this._init()},sforce.SplitView.prototype={_init:function(){var a=this;isPortrait=function(){return window.innerHeight>window.innerWidth};var b=function(){switch(isPortrait()){case true:$j("#listpage").appendTo("#popover");$j("#popover").css("visibility","hidden").css("opacity","0").show();$j("#contactlist_button").show().text(contactPluralLabel).touch(function(){$j("#popover,#contactlist_button").windowTouch(function(){return false},
function(){a.focusOutContactList();return true},false);$j("#popover").css("visibility","").css("opacity","1")});break;case false:$j("#popover").hide();$j("#rightsection").before($j("#listpage"));$j("#contactlist_button").hide().unbindTouch();$j("#popover,#contactlist_button").unbindWindowTouch()}a.callbacks.fire(isPortrait())};$j(window).orientationChange(function(){(isPortrait()&&$j("#listpage").parent()[0].id!="popover"||!isPortrait()&&$j("#listpage").parent()[0].id=="popover")&&b()});b()},focusOutContactList:function(){switch(window.innerHeight>
window.innerWidth){case true:var a=$j("#popover"),b=function(){a.css("visibility","hidden").unbind("webkitTransitionEnd")};a.css("opacity")!="0"&&a.bind("webkitTransitionEnd",b);a.css("opacity","0");$j("#popover,#contactlist_button").unbindWindowTouch()}},addOrientationChangeCallback:function(a){typeof a=="function"&&this.callbacks.add(a)},removeOrientationChangeCallback:function(a){typeof a=="function"&&this.callbacks.remove(a)}});
var StorageManager=function(){return{checkLocalStorage:function(){return typeof localStorage=="undefined"?false:true},checkSessionStorage:function(){return typeof sessionStorage=="undefined"?false:true},clearAll:function(){this.checkLocalStorage()&&localStorage.clear();this.checkSessionStorage()&&sessionStorage.clear()},setLocalValue:function(a,b){this.checkLocalStorage()&&localStorage.setItem(a,b)},getLocalValue:function(a){if(this.checkLocalStorage())return localStorage.getItem(a)},clearLocalValue:function(a){this.checkLocalStorage()&&
localStorage.removeItem(a)},setSessionValue:function(a,b){this.checkSessionStorage()&&sessionStorage.setItem(a,b)},getSessionValue:function(a){if(this.checkSessionStorage())return sessionStorage.getItem(a)},clearSessionValue:function(a){this.checkSessionStorage()&&sessionStorage.removeItem(a)}}}();
void 0===window.LocalyticsManager&&(window.LocalyticsManager=function(){this.device=DEVICE_TYPE;localyticsSession.init(localyticsAppId);localyticsSession.open();localyticsSession.upload();this.uploadTimer=setInterval(localyticsSession.upload,6E4)});
void 0!=window.LocalyticsManager&&(LocalyticsManager.prototype.tagScreen=function(){},LocalyticsManager.prototype.tagSplitView=function(){},LocalyticsManager.prototype.tagPortraitView=function(){},LocalyticsManager.prototype.tagEvent=function(a,b){localyticsSession.tagEvent(a,b)},LocalyticsManager.prototype.tagListView=function(a,b){this.prevListName!=void 0&&this.prevListName&&this.tagEvent("LIST-"+this.prevListName.toUpperCase()+"-CLOSE",{timeSpent:(Date.now()-this.listTagTime)/1E3});this.tagEvent("LIST-"+
a.toUpperCase()+"-OPEN",{records:b});this.prevListName=a;this.listTagTime=Date.now()},LocalyticsManager.prototype.tagSearch=function(a){this.tagListView("search",a)},LocalyticsManager.prototype.tagDetailView=function(a,b){this.prevDetailView!=void 0&&this.prevDetailView&&this.tagEvent(this.device+"-DETAIL-"+this.prevDetailView.toUpperCase()+"-CLOSE",{timeSpent:(Date.now()-this.detailTagTime)/1E3});this.tagEvent(this.device+"-DETAIL-"+a.toUpperCase()+"-OPEN",{loadTime:b});this.prevDetailView=a;this.detailTagTime=
Date.now()});function saveUserPic(){navigator.camera.getPicture(onPicSuccess,onPicFail,{quality:50})}function showContactPicture(a){a=(a=StorageManager.getLocalValue(a+"__pic"))?"data:image/jpeg;base64,"+a:staticRsrcUrl+"/images/userPicwBorder.png";$j("#photo_div img").attr("src",a)}
function onPicSuccess(a){ManageUserSession.getApiClient().addAttachment("ContactViewer-UserPhoto",listView.selectedContactId,a);StorageManager.setLocalValue(listView.selectedContactId+"__pic",a);showContactPicture(listView.selectedContactId)}function onPicFail(a){console.log("Pic Failed because: "+a)}
$j(function(){$j("#photo_div img").enableTap().click(saveUserPic);if(typeof sforce.Client!="undefined")sforce.Client.prototype.addAttachment=function(a,b,d,c,e,f){var g=getBaseUrl()+"/services/apexrest/cvapi?action=insertSObject&sobject=Attachment";this.ajax("POST",g,{Name:a,ParentId:b,Body:d},c,e,f)}});