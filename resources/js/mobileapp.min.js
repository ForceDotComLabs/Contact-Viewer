/*Copyright (c) 2011, salesforce.com <http://salesforce.com> , inc.*/
var login_redirect_storage_key="SFDC-LOGIN-REDIRECT",infopagescroll,hasRecordTypes=!1,hasChatterEnabled=!1,contactLabel="Contact",contactPluralLabel="Contacts",listView,splitView,sobjectModel;function initiateInfoScroller(){void 0===infopagescroll?(infopagescroll=createScroller("infoscroller"),$j(window).orientationChange(initiateInfoScroller)):infopagescroll.refresh()}
function destroyInfoScroller(){infopagescroll&&($j(window).unbindOrientationChange(initiateInfoScroller),infopagescroll.destroy(),infopagescroll=void 0)}
function sessionCallback(){var a,b,c,d=StorageManager.getLocalValue(last_visited_loc_storage_key);$j("#loggedin").css("display","block");c=$j("#loggedin").showActivityInd("Loading...");addClickListeners();d&&2==d.split("/").length&&(d=d.split("/"),b=d[0],a=function(a){a&&(c.hide(),showContact(b,LocalyticsManager.logAppReady))});fetchContactDescribe(a);sobjectModel={setRecords:function(a){this.records=a;this.recordIds=[];for(i in a)this.recordIds.push(a[i].Id)}};splitView=new sforce.SplitView;listView=
new sforce.ListView({selectedContactId:b,onListSelect:getContacts,onSearch:searchContacts,onItemSelect:showContact});splitView.addOrientationChangeCallback(function(a){listView.refreshScroller();LocalyticsManager.tagScreenOrientation(a)});listView.displayList("recent",c.hide);"function"==typeof window.addToHomeLaunch&&window.addToHomeLaunch()}
function switchToDetail(a){useAnimations?$j("#listpage").changePage("#detailpage",!1,a):($j("#listpage").hide(),$j("#detailpage").show().css("visibility",""),"function"==typeof a&&a())}function addClickListeners(){$j("#listpage #header #gear").off().enableTap().click(function(a){a.preventDefault();SettingsManager.show()})}
function showContact(a,b){var c,d;$j("#detailpage #detail").hide();$j("#detailpage .header>span").empty();switchToDetail();c=$j("#loggedin").showActivityInd("Loading...");d=switchDetailSection("info",[a],function(a){a&&$j("#detailpage #detail").show();c.hide();"function"==typeof b&&b()});$j("#detailpage .header #left").off().enableTap().click(function(){var a=function(){$j("#detailpage").css("visibility","hidden");listView.resetSelectedContact()};d.abort();$j("#detailpage .header #left").off();useAnimations?
$j("#detailpage").changePage("#listpage",!0,a):($j("#detailpage").hide(),$j("#listpage").show().css("visibility",""),a());updateLastVisitLoc()});updateLastVisitLoc(a+"/info");"function"==typeof showContactPicture&&showContactPicture(a)}
function displayContactSummary(a){$j("#Id").val(a.Id);getFieldDescribe();var b=$j("#detailpage #detail");b.find("#summary #photo_div>div").html(a.Name).append("<br/>").append(a.Title?formatStr(a.Title)+", ":"").append(formatStr(a.Department)||"&nbsp;").append("<br/>").append(a.Account?formatStr(a.Account.Name):"&nbsp;");if(a.Phone){var c=cleanupPhone(a.Phone);b.find("#call_contact #skype").attr("href","skype:"+c+"?call").show();/ipad|iphone/gi.test(navigator.platform)?b.find("#call_contact #facetime").attr("href",
"facetime://"+c).show():b.find("#call_contact #facetime").hide()}else b.find("#call_contact #skype").attr("href","#").hide(),b.find("#call_contact #facetime").attr("href","#").hide();a.Email?b.find("#call_contact #email").attr("href","mailto:"+a.Email).show():b.find("#call_contact #email").attr("href","#").hide()}
function displayContactDetails(a){var b=getFieldDescribe(),c=$j("#detailpage #detail #info");b.Phone?(c.find("#Phone").show(),c.find("#Phone.rowLabel span").text(b.Phone.label),c.find("#Phone.rowValue span").html(a.Phone?'<a href="tel:'+formatStr(cleanupPhone(a.Phone))+'" style="text-decoration:none;">'+formatStr(a.Phone,30)+"</a>":"&nbsp;")):c.find("#Phone").hide();b.MobilePhone?(c.find("#Mobile").show(),c.find("#Mobile.rowLabel span").text(b.MobilePhone.label),c.find("#Mobile.rowValue span").html(a.MobilePhone?
'<a href="tel:'+formatStr(cleanupPhone(a.MobilePhone))+'">'+formatStr(a.MobilePhone,30)+"</a>":"&nbsp;")):c.find("#Mobile").hide();b.Email?(c.find("#Email").show(),c.find("#Email.rowLabel span").text(b.Email.label),c.find("#Email.rowValue span").html(a.Email?'<a href="mailto:'+a.Email+'" style="text-decoration:none;">'+formatStr(a.Email,50)+"</a>":"&nbsp;")):c.find("#Email").hide();void 0!=b.MailingStreet?(a=formatAddress(a),c.find("#Address").show(),c.find("#Address.rowLabel span").text("Mailing Address"),
0<a.length?(b=("undefined"!=typeof PhoneGap&&PhoneGap?"maps:q=":"https://maps.google.com/maps?q=")+encodeURI(a.replace(/\n/g,", ")),a='<a href="'+b+'">'+a.replace(/\n/g,"<br/>")+"</a>",c.find("#Address.rowValue span").html(a)):c.find("#Address.rowValue span").empty()):c.find("#Address").hide()}
function renderContactInfo(a,b){var c=!1,d="Id Name Account.Id Account.Name Department Title Phone MobilePhone Email MailingStreet MailingCity MailingState MailingCountry MailingPostalCode ReportsTo.Name".split(" ");hasRecordTypes&&d.push("RecordTypeId");var e=getFieldDescribe(),d=d.filter(function(a){a=a.split(".");return e[a[0]]});$j("#detailpage #detail #info");return ManageUserSession.getApiClient().retrieveContactViaApex(a,d,function(a){a&&"Id"in a?($j("#detailpage .header>span").text(a.Name),
displayContactSummary(a),displayContactDetails(a),c=!0):alert(contactLabel+" not found. Please refresh the list and try again.")},errorCallback,function(){"function"==typeof b&&(setTimeout(function(){initiateInfoScroller();infopagescroll.scrollTo(0,0,0)},10),b(c))})}
function switchDetailSection(a,b,c){var d=Date.now();$j("#detailpage #contactInfo").show();$j("#detailpage #detail>span>div").hide();var e=function(b){LocalyticsManager.tagDetailView(a,Date.now()-d);"function"==typeof c&&c(b)};if("info"==a)return LocalyticsManager.tagScreen("Detail"),renderContactInfo(b[0],function(a){a&&$j("#detailpage #detail #infoscroller").show();e(a)});e();updateLastVisitLoc(b[0]+"/"+a)};