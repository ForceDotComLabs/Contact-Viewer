/*Copyright (c) 2011, salesforce.com <http://salesforce.com> , inc.*/
var login_redirect_storage_key="SFDC-LOGIN-REDIRECT",infopagescroll,hasRecordTypes=!1,hasChatterEnabled=!1,contactLabel="Contact",contactPluralLabel="Contacts",listView,splitView,sobjectModel;function initiateInfoScroller(){void 0===infopagescroll?(infopagescroll=createScroller("infoscroller"),$j(window).orientationChange(initiateInfoScroller)):infopagescroll.refresh()}
function destroyInfoScroller(){infopagescroll&&($j(window).unbindOrientationChange(initiateInfoScroller),infopagescroll.destroy(),infopagescroll=void 0)}
function sessionCallback(){$j("#loggedin").css("display","block");addClickListeners();var a,c,b=$j("#loggedin").showActivityInd("Loading..."),d=StorageManager.getLocalValue(last_visited_loc_storage_key);d&&2==d.split("/").length&&(d=d.split("/"),c=d[0],a=function(a){a&&(b.hide(),showContact(c))});fetchContactDescribe(a);sobjectModel={setRecords:function(a){this.records=a;this.recordIds=[];for(i in a)this.recordIds.push(a[i].Id)}};splitView=new sforce.SplitView;listView=new sforce.ListView({selectedContactId:c,
onListSelect:getContacts,onSearch:searchContacts,onItemSelect:showContact});splitView.addOrientationChangeCallback(function(){listView.refreshScroller()});getContacts("recent",b.hide);"function"==typeof window.addToHomeLaunch&&window.addToHomeLaunch()}function switchToDetail(a){useAnimations?$j("#listpage").changePage("#detailpage",!1,a):($j("#listpage").hide(),$j("#detailpage").show().css("visibility",""),"function"==typeof a&&a())}
function addClickListeners(){$j("#listpage #header #gear").off().enableTap().click(function(a){a.preventDefault();SettingsManager.show()})}
function showContact(a,c){$j("#detailpage #detail").hide();$j("#detailpage .header>span").empty();switchToDetail();var b=$j("#loggedin").showActivityInd("Loading...");switchDetailSection("info",[a],function(a){a&&$j("#detailpage #detail").show();$j("#detailpage .header #left").off().enableTap().click(function(){var a=function(){$j("#detailpage").css("visibility","hidden");listView.resetSelectedContact()};$j("#detailpage .header #left").off();useAnimations?$j("#detailpage").changePage("#listpage",
!0,a):($j("#detailpage").hide(),$j("#listpage").show().css("visibility",""),a());updateLastVisitLoc()});b.hide();"function"==typeof c&&c()});updateLastVisitLoc(a+"/info")}
function displayContactSummary(a){$j("#Id").val(a.Id);getFieldDescribe();var c=$j("#detailpage #detail");c.find("#summary #photo_div>div").html(a.Name).append("<br/>").append(a.Title?formatStr(a.Title)+", ":"").append(formatStr(a.Department)||"&nbsp;").append("<br/>").append(a.Account?formatStr(a.Account.Name):"&nbsp;");if(a.Phone){var b=cleanupPhone(a.Phone);c.find("#call_contact #skype").attr("href","skype:"+b+"?call").show();/ipad|iphone/gi.test(navigator.platform)?c.find("#call_contact #facetime").attr("href",
"facetime://"+b).show():c.find("#call_contact #facetime").hide()}else c.find("#call_contact #skype").attr("href","#").hide(),c.find("#call_contact #facetime").attr("href","#").hide();a.Email?c.find("#call_contact #email").attr("href","mailto:"+a.Email).show():c.find("#call_contact #email").attr("href","#").hide()}
function displayContactDetails(a){var c=getFieldDescribe(),b=$j("#detailpage #detail #info");c.Phone?(b.find("#Phone").show(),b.find("#Phone.rowLabel span").text(c.Phone.label),b.find("#Phone.rowValue span").html(a.Phone?'<a href="tel:'+formatStr(cleanupPhone(a.Phone))+'" style="text-decoration:none;">'+formatStr(a.Phone,30)+"</a>":"&nbsp;")):b.find("#Phone").hide();c.MobilePhone?(b.find("#Mobile").show(),b.find("#Mobile.rowLabel span").text(c.MobilePhone.label),b.find("#Mobile.rowValue span").html(a.MobilePhone?
'<a href="tel:'+formatStr(cleanupPhone(a.MobilePhone))+'">'+formatStr(a.MobilePhone,30)+"</a>":"&nbsp;")):b.find("#Mobile").hide();c.Email?(b.find("#Email").show(),b.find("#Email.rowLabel span").text(c.Email.label),b.find("#Email.rowValue span").html(a.Email?'<a href="mailto:'+a.Email+'" style="text-decoration:none;">'+formatStr(a.Email,50)+"</a>":"&nbsp;")):b.find("#Email").hide();void 0!=c.MailingStreet?(a=formatAddress(a),b.find("#Address").show(),b.find("#Address.rowLabel span").text("Mailing Address"),
0<a.length?(a='<a href="https://maps.google.com/maps?q='+encodeURI(a.replace(/\n/g,", "))+'">'+a.replace(/\n/g,"<br/>")+"</a>",b.find("#Address.rowValue span").html(a)):b.find("#Address.rowValue span").empty()):b.find("#Address").hide()}
function renderContactInfo(a,c){var b=!1,d="Id Name Account.Id Account.Name Department Title Phone MobilePhone Email MailingStreet MailingCity MailingState MailingCountry MailingPostalCode ReportsTo.Name".split(" ");hasRecordTypes&&d.push("RecordTypeId");var e=getFieldDescribe(),d=d.filter(function(a){a=a.split(".");return e[a[0]]});$j("#detailpage #detail #info");ManageUserSession.getApiClient().retrieveContactViaApex(a,d,function(a){a&&"Id"in a?($j("#detailpage .header>span").text(a.Name),displayContactSummary(a),
displayContactDetails(a),b=!0):alert(contactLabel+" not found. Please refresh the list and try again.")},errorCallback,function(){"function"==typeof c&&(setTimeout(function(){initiateInfoScroller();infopagescroll.scrollTo(0,0,0)},10),c(b))})}
function switchDetailSection(a,c,b){$j("#detailpage #contactInfo").show();$j("#detailpage #detail>span>div").hide();"info"==a?renderContactInfo(c[0],function(a){a&&$j("#detailpage #detail #infoscroller").show();"function"==typeof b&&b(a)}):"function"==typeof b&&b(void 0);updateLastVisitLoc(c[0]+"/"+a)};