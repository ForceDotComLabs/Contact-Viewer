/*Copyright (c) 2011, salesforce.com <http://salesforce.com> , inc.*/
var login_redirect_storage_key="SFDC-LOGIN-REDIRECT",infopagescroll,hasRecordTypes=!1,hasChatterEnabled=!1,contactLabel="Contact",contactPluralLabel="Contacts",listView,splitView,sobjectModel;function initiateInfoScroller(){void 0===infopagescroll?(infopagescroll=createScroller("contactInfo"),$j(window).orientationChange(initiateInfoScroller)):infopagescroll.refresh()}
function destroyInfoScroller(){infopagescroll&&($j(window).unbindOrientationChange(initiateInfoScroller),infopagescroll.destroy(),infopagescroll=void 0)}
function sessionCallback(){var a,c,d,b=StorageManager.getLocalValue(last_visited_loc_storage_key);$j("#loggedin").css("display","block");d=$j("#loggedin").showActivityInd("Loading...");addClickListeners();b&&2==b.split("/").length&&(b=b.split("/"),c=b[0],a=function(a){a&&(d.hide(),showContact(c,LocalyticsManager.logAppReady))});fetchContactDescribe(a);sobjectModel={setRecords:function(a){this.records=a;this.recordIds=[];for(i in a)this.recordIds.push(a[i].Id)}};splitView=new sforce.SplitView;listView=
new sforce.ListView({selectedContactId:c,onListSelect:getContacts,onSearch:searchContacts,onItemSelect:showContact});splitView.addOrientationChangeCallback(function(a){listView.refreshScroller();LocalyticsManager.tagScreenOrientation(a)});listView.displayList("recent",d.hide);"function"==typeof window.addToHomeLaunch&&window.addToHomeLaunch()}
function switchToDetail(a){useAnimations?$j("#listpage").changePage("#detailpage",!1,a):($j("#listpage").hide(),$j("#detailpage").show().css("visibility",""),"function"==typeof a&&a())}function addClickListeners(){$j("#listpage #header #gear").off().enableTap().click(function(a){a.preventDefault();SettingsManager.show()})}
function showContact(a,c){var d,b;$j("#detailpage #detail").hide();$j("#detailpage .header>span").empty();switchToDetail();d=$j("#loggedin").showActivityInd("Loading...");$j("#detailpage .header #left").off().enableTap().click(function(){var a=function(){$j("#detailpage").css("visibility","hidden");listView.resetSelectedContact()};b.abort();$j("#detailpage .header #left").off();useAnimations?$j("#detailpage").changePage("#listpage",!0,a):($j("#detailpage").hide(),$j("#listpage").show().css("visibility",
""),a());updateLastVisitLoc()});b=switchDetailSection("info",[a],function(a){a&&$j("#detailpage #detail").show();d.hide();"function"==typeof c&&c()});updateLastVisitLoc(a+"/info")}function displayContactSummary(a){$j("#Id").val(a.Id);getFieldDescribe();$j("#detailpage #detail").find("#photo_div>div").html(a.Name).append("<br/>").append(a.Title?formatStr(a.Title)+", ":"").append(formatStr(a.Department)||"&nbsp;").append("<br/>").append(a.Account?formatStr(a.Account.Name):"&nbsp;")}
function displayContactDetails(a){var c=getFieldDescribe(),d=$j("#detailpage #detail #info"),b=[],e=[],g=[],h="",j="";d.empty();for(var f in a)if(c[f]&&a[f])switch(c[f].type.toLowerCase()){case "phone":0<b.length&&b.push('<hr class="rowSeparator"/>');b.push('<div class="rowLabel fieldLbl"><span>'+c[f].label+"</span></div>");b.push('<div id="'+f+'" class="rowValue"><span><a id="phone" href="tel:'+cleanupPhone(a[f])+'" style="text-decoration:none;">'+a[f]+"</a></span></div>");break;case "email":0<e.length&&
e.push('<hr class="rowSeparator"/>'),e.push('<div class="rowLabel fieldLbl"><span>'+c[f].label+"</span></div>"),e.push('<div id="'+f+'" class="rowValue"><span><a href="mailto:'+a[f]+'" style="text-decoration:none;">'+a[f]+"</a></span></div>")}0<b.length&&d.append('<div class="roundedBox">'+b.join("")+"</div>");0<e.length&&d.append('<div class="roundedBox">'+e.join("")+"</div>");void 0!=c.MailingStreet&&(h=formatAddress(a),0<h.length&&(j="https://maps.google.com/maps?q="+encodeURIComponent(h.replace(/\n/g,
", "))),g.push('<div class="rowLabel fieldLbl"><span>Mailing Address</span></div>'),g.push('<div id="Address" class="rowValue"><span>'),g.push('<a href="'+j+'" style="text-decoration:none;" target="_blank">'+h.replace(/\n/g,"<br/>")+"</a>"),g.push("</span></div>"),d.append('<div class="roundedBox">'+g.join("")+"</div>"));ActionManager.attachHandler(d.find(".rowValue a"))}
function renderContactInfo(a,c){var d=!1,b="Id Name Account.Id Account.Name Department Title MailingStreet MailingCity MailingState MailingCountry MailingPostalCode ReportsTo.Name".split(" ");hasRecordTypes&&b.push("RecordTypeId");var e=getFieldDescribe(),b=b.filter(function(a){a=a.split(".")[0];return a in e}),g;for(g in e){var h=e[g].type.toLowerCase();("email"==h||"phone"==h)&&b.push(g)}$j("#detailpage #detail #info");return ManageUserSession.getApiClient().retrieveContactViaApex(a,b,function(a){a&&
"Id"in a?($j("#detailpage .header>span").text(a.Name),displayContactSummary(a),displayContactDetails(a),d=!0):alert(contactLabel+" not found. Please refresh the list and try again.")},errorCallback,function(){"function"==typeof c&&(setTimeout(function(){initiateInfoScroller();infopagescroll.scrollTo(0,0,0)},10),c(d))})}
function switchDetailSection(a,c,d){var b=Date.now();$j("#detailpage #contactInfo").show();$j("#detailpage #detail>span>div").hide();var e=function(c){LocalyticsManager.tagDetailView(a,Date.now()-b);"function"==typeof d&&d(c)};if("info"==a)return LocalyticsManager.tagScreen("Detail"),renderContactInfo(c[0],function(a){a&&$j("#detailpage #detail #infoscroller").show();e(a)});e();updateLastVisitLoc(c[0]+"/"+a)};