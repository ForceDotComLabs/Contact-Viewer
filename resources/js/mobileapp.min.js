/*Copyright (c) 2011, salesforce.com <http://salesforce.com> , inc.*/
var login_redirect_storage_key="SFDC-LOGIN-REDIRECT",infopagescroll,hasRecordTypes=!1,hasChatterEnabled=!1,contactLabel="Contact",contactPluralLabel="Contacts",listView,splitView,sobjectModel;function initiateInfoScroller(){void 0===infopagescroll?(infopagescroll=createScroller("infoscroller"),$j(window).orientationChange(initiateInfoScroller)):infopagescroll.refresh()}
function destroyInfoScroller(){infopagescroll&&($j(window).unbindOrientationChange(initiateInfoScroller),infopagescroll.destroy(),infopagescroll=void 0)}
function sessionCallback(){var a,b,d,c=StorageManager.getLocalValue(last_visited_loc_storage_key);$j("#loggedin").css("display","block");d=$j("#loggedin").showActivityInd("Loading...");addClickListeners();c&&2==c.split("/").length&&(c=c.split("/"),b=c[0],a=function(a){a&&(d.hide(),showContact(b,LocalyticsManager.logAppReady))});fetchContactDescribe(a);sobjectModel={setRecords:function(a){this.records=a;this.recordIds=[];for(i in a)this.recordIds.push(a[i].Id)}};splitView=new sforce.SplitView;listView=
new sforce.ListView({selectedContactId:b,onListSelect:getContacts,onSearch:searchContacts,onItemSelect:showContact});splitView.addOrientationChangeCallback(function(a){listView.refreshScroller();LocalyticsManager.tagScreenOrientation(a)});listView.displayList("recent",d.hide);"function"==typeof window.addToHomeLaunch&&window.addToHomeLaunch()}
function switchToDetail(a){useAnimations?$j("#listpage").changePage("#detailpage",!1,a):($j("#listpage").hide(),$j("#detailpage").show().css("visibility",""),"function"==typeof a&&a())}function addClickListeners(){$j("#listpage #header #gear").off().enableTap().click(function(a){a.preventDefault();SettingsManager.show()})}
function showContact(a,b){var d,c;$j("#detailpage #detail").hide();$j("#detailpage .header>span").empty();switchToDetail();d=$j("#loggedin").showActivityInd("Loading...");c=switchDetailSection("info",[a],function(a){a&&$j("#detailpage #detail").show();d.hide();"function"==typeof b&&b()});$j("#detailpage .header #left").off().enableTap().click(function(){var a=function(){$j("#detailpage").css("visibility","hidden");listView.resetSelectedContact()};c.abort();$j("#detailpage .header #left").off();useAnimations?
$j("#detailpage").changePage("#listpage",!0,a):($j("#detailpage").hide(),$j("#listpage").show().css("visibility",""),a());updateLastVisitLoc()});updateLastVisitLoc(a+"/info")}
function displayContactSummary(a){$j("#Id").val(a.Id);getFieldDescribe();var b=$j("#detailpage #detail");b.find("#summary #photo_div>div").html(a.Name).append("<br/>").append(a.Title?formatStr(a.Title)+", ":"").append(formatStr(a.Department)||"&nbsp;").append("<br/>").append(a.Account?formatStr(a.Account.Name):"&nbsp;");if(a.Phone){var d=cleanupPhone(a.Phone);b.find("#call_contact #skype").attr("href","skype:"+d+"?call").show();/ipad|iphone/gi.test(navigator.platform)?b.find("#call_contact #facetime").attr("href",
"facetime://"+d).show():b.find("#call_contact #facetime").hide()}else b.find("#call_contact #skype").attr("href","#").hide(),b.find("#call_contact #facetime").attr("href","#").hide();a.Email?b.find("#call_contact #email").attr("href","mailto:"+a.Email).show():b.find("#call_contact #email").attr("href","#").hide()}
function displayContactDetails(a){var b=getFieldDescribe(),d=$j("#detailpage #detail #info"),c=[],e=[],g=[],h="",j="";d.empty();for(var f in a)if(b[f]&&a[f])switch(b[f].type.toLowerCase()){case "phone":0<c.length&&c.push('<hr class="rowSeparator"/>');c.push('<div class="rowLabel fieldLbl"><span>'+b[f].label+"</span></div>");c.push('<div id="'+f+'" class="rowValue"><span><a href="tel:'+cleanupPhone(a[f])+'" style="text-decoration:none;">'+a[f]+"</a></span></div>");break;case "email":0<e.length&&e.push('<hr class="rowSeparator"/>'),
e.push('<div class="rowLabel fieldLbl"><span>'+b[f].label+"</span></div>"),e.push('<div id="'+f+'" class="rowValue"><span><a href="mailto:'+a[f]+'" style="text-decoration:none;">'+a[f]+"</a></span></div>")}0<c.length&&d.append('<div class="roundedBox">'+c.join("")+"</div>");0<e.length&&d.append('<div class="roundedBox">'+e.join("")+"</div>");void 0!=b.MailingStreet&&(h=formatAddress(a),0<h.length&&(j=("undefined"!=typeof PhoneGap&&PhoneGap?"maps:q=":"https://maps.google.com/maps?q=")+encodeURI(h.replace(/\n/g,
", "))),g.push('<div class="rowLabel fieldLbl"><span>Mailing Address</span></div>'),g.push('<div id="Address" class="rowValue"><span><a href="'+j+'" style="text-decoration:none;" target="_blank">'+h.replace(/\n/g,"<br/>")+"</a></span></div>"),d.append('<div class="roundedBox">'+g.join("")+"</div>"))}
function renderContactInfo(a,b){var d=!1,c="Id Name Account.Id Account.Name Department Title MailingStreet MailingCity MailingState MailingCountry MailingPostalCode ReportsTo.Name".split(" ");hasRecordTypes&&c.push("RecordTypeId");var e=getFieldDescribe(),c=c.filter(function(a){a=a.split(".")[0];return a in e}),g;for(g in e){var h=e[g].type.toLowerCase();("email"==h||"phone"==h)&&c.push(g)}$j("#detailpage #detail #info");return ManageUserSession.getApiClient().retrieveContactViaApex(a,c,function(a){a&&
"Id"in a?($j("#detailpage .header>span").text(a.Name),displayContactSummary(a),displayContactDetails(a),d=!0):alert(contactLabel+" not found. Please refresh the list and try again.")},errorCallback,function(){"function"==typeof b&&(setTimeout(function(){initiateInfoScroller();infopagescroll.scrollTo(0,0,0)},10),b(d))})}
function switchDetailSection(a,b,d){var c=Date.now();$j("#detailpage #contactInfo").show();$j("#detailpage #detail>span>div").hide();var e=function(b){LocalyticsManager.tagDetailView(a,Date.now()-c);"function"==typeof d&&d(b)};if("info"==a)return LocalyticsManager.tagScreen("Detail"),renderContactInfo(b[0],function(a){a&&$j("#detailpage #detail #infoscroller").show();e(a)});e();updateLastVisitLoc(b[0]+"/"+a)};